# 📦 FBA注文処理システム - ユーザーガイド

このガイドは、FBA注文処理システムを初めて使用する方向けの手順書です。

---

## 📋 目次

1. [システムの概要](#システムの概要)
2. [必要なファイル](#必要なファイル)
3. [基本的な使い方](#基本的な使い方)
4. [各タブの詳細説明](#各タブの詳細説明)
5. [よくある質問（FAQ）](#よくある質問faq)
6. [トラブルシューティング](#トラブルシューティング)

---

## 🎯 システムの概要

このシステムは、Amazon FBA注文の**原価計算**を自動で行うツールです。

### 主な機能

- ✅ 複数のExcelファイルから情報を自動取得
- ✅ 原価を自動計算（購入単価、送料、オプション費用、関税など）
- ✅ 計算結果をExcelファイルで出力
- ✅ データの整合性チェック（数量不一致などのエラー検出）

### 出力される情報

- ASIN、SKU、商品名
- **原価（円）** ← これが最も重要です
- 購入単価、送料、オプション費用、関税などの内訳
- 配送情報（配送依頼No.、納品プランNo.、追跡番号など）

---

## 📁 必要なファイル

処理を実行するために、以下のファイルを準備してください。

### ✅ 必須ファイル（必ず必要）

| ファイル名 | 説明 | 例 |
|-----------|------|-----|
| **FBA指示書** | 配送依頼No.、納品プランNo.、追跡番号を含む指示書 | `FBA指示書 20251112-1111 663864 FBA15G3H2BH8 VIP6003078722.xls` |
| **send-order-list** | 注文情報、単価、数量、中国国内送料 | `send-order-list - 2025-12-26T223921.267.xls` |
| **record-list** | 注文番号と商品金額 | `record-list (20).xls` |

### 📎 オプションファイル（あれば便利）

| ファイル名 | 説明 | 必須度 |
|-----------|------|--------|
| **Jancode.xlsx** | ASIN、SKU、商品名、寸法情報 | 推奨（国際送料計算に必要） |
| **輸入許可通知書（PDF）** | 関税、消費税、地方消費税の情報 | 推奨（関税計算に必要） |

---

## 🚀 基本的な使い方

### ステップ1: ファイルをアップロード

1. **「ファイル選択」タブ**を開く
2. 各ファイルのアップロード欄から、対応するファイルを選択
3. 必須ファイル（FBA指示書、send-order-list、record-list）は必ずアップロード
4. オプションファイルも可能な限りアップロード（計算精度が向上します）

### ステップ2: データを確認

1. **「データ確認」タブ**を開く
2. 各ファイルのプレビューを確認
3. データが正しく読み込まれているか確認
   - ASIN、数量、金額などが表示されているか
   - エラーメッセージが出ていないか

### ステップ3: メール情報を入力（必要に応じて）

1. **「ファイル選択」タブ**の下部にある「📧 メールから取得する情報の手動入力」セクションを開く
2. 配送依頼No.を入力
3. 以下の情報を入力：
   - **国際送料（元）**
   - **オプション料金（元）**
   - **通関手数料（元）**
   - **中国国内送料（元）**
4. 「💾 保存」ボタンをクリック

### ステップ4: 処理を実行

1. **「処理実行」タブ**を開く
2. **元→円レート（円/元）**を入力
   - 例: `22.77`
   - 前日のTTS + 0.5で計算
3. **「🚀 処理を開始」**ボタンをクリック
4. 処理が完了するまで待つ（数秒〜数十秒）

### ステップ5: 結果を確認・ダウンロード

1. **「結果表示」タブ**を開く
2. 処理結果の表を確認
3. 原価計算の検証（任意）：
   - ASINを選択すると、原価がどのように計算されたか詳細を確認できます
4. **「📥 Excelファイルをダウンロード」**ボタンをクリックして結果を保存

---

## 📑 各タブの詳細説明

### 📂 ファイル選択タブ

このタブでは、処理に必要なファイルをアップロードします。

#### 必須ファイルのアップロード

1. **FBA指示書**
   - ファイル名に「FBA指示書」が含まれるExcelファイル（.xls または .xlsx）
   - 配送依頼No.、納品プランNo.、追跡番号が自動で抽出されます

2. **send-order-list**
   - ファイル名に「send-order-list」が含まれるExcelファイル
   - 注文情報、単価、数量、中国国内送料が含まれます

3. **record-list**
   - ファイル名に「record-list」が含まれるExcelファイル
   - 注文番号と商品金額が含まれます

#### オプションファイルのアップロード

- **Jancode.xlsx**: 寸法情報があると、国際送料の計算精度が向上します
- **輸入許可通知書（PDF）**: 関税情報があると、原価計算が正確になります

#### メール情報の手動入力

メールで受け取った情報を手動で入力できます：

1. **配送依頼No.**を入力
2. 各項目を入力：
   - 国際送料（元）
   - オプション料金（元）
   - 通関手数料（元）
   - 中国国内送料（元）
3. オプション料金の内訳がある場合は、詳細も入力可能
4. 「💾 保存」をクリック

#### 追加オプション費用の配分（例外処理4）

メールのオプション料金と指示書のオプション費用に差がある場合：

1. **配送依頼No.**を選択
2. **金額（元）**を入力
3. **説明**を入力（例: "特殊検品"）
4. **配分先ASIN**をカンマ区切りで入力（例: `B0BKFS9N54` または `B0G1LDVHGV,B0G1LL31KR`）
5. 「追加」ボタンをクリック

---

### 👀 データ確認タブ

このタブでは、アップロードしたファイルの内容を確認できます。

#### 表示される情報

- **📄 fbaのプレビュー**: 指示書に記載されている商品一覧
- **📄 jancodeのプレビュー**: ASIN、SKU、寸法情報
- **📄 send_orderのプレビュー**: 注文情報、単価、数量、中国国内送料
- **📄 record_listのプレビュー**: 注文番号と商品金額
- **📄 輸入許可通知書（PDF）のプレビュー**: 関税、消費税、地方消費税

#### 色分けの意味

- **🔵 青緑色の背景**: 原価計算に使用される項目
- **🟡 黄色の背景**: 寸法情報（国際送料計算に使用）

#### PDFの手動修正

PDFから自動抽出された関税情報が不正確な場合：

1. 「🔧 手動で修正する」を展開
2. 正しい値を入力
3. 「✓ 手動入力値を使用」をクリック

---

### ⚙️ 処理実行タブ

このタブでは、実際の処理を実行します。

#### 為替レートの設定

**元→円レート（円/元）**を入力してください。

- 例: `22.77`
- 計算方法: 前日のTTS + 0.5
- 参考サイト: https://www.murc-kawasesouba.jp/fx/past_3month.php

#### 処理の実行

1. 為替レートを入力
2. **「🚀 処理を開始」**ボタンをクリック
3. プログレスバーで進捗を確認
4. 「✅ 処理が完了しました！」と表示されたら完了

#### エラーが発生した場合

- エラーメッセージを確認
- 不足しているファイルがないか確認
- 「ファイル選択」タブでファイルを再アップロード

---

### 📊 結果表示タブ

このタブでは、処理結果を確認・ダウンロードできます。

#### 処理結果の表

- **🔵 青緑色の背景**: 原価計算に使用される項目
- **🔷 濃い青色の背景**: 原価（合計）
- 各列の意味は、表の上部にある凡例を参照

#### 原価計算の検証

任意のASINを選択すると、原価がどのように計算されたかを詳細に確認できます：

1. **ASINを選択**ドロップダウンから選択
2. **5つのコンポーネントカード**で各コスト要素を確認：
   - ①購入単価
   - ②中国国内送料
   - ③オプション費用
   - ④国際送料
   - ⑤関税
3. **計算結果**で、計算式と結果を確認
4. **✅ 一致**または**⚠️ 差異あり**で、表の原価と計算結果を比較

#### Excelファイルのダウンロード

1. **「📥 Excelファイルをダウンロード」**ボタンをクリック
2. ファイル名: `FBA処理結果.xlsx`
3. ダウンロードフォルダに保存されます

---

## ❓ よくある質問（FAQ）

### Q1: どのファイルが必須ですか？

**A:** 以下の3つは必須です：
- FBA指示書
- send-order-list
- record-list

その他のファイル（Jancode.xlsx、PDFなど）はオプションですが、あると計算精度が向上します。

### Q2: 為替レートはどこで確認できますか？

**A:** 以下のサイトで確認できます：
https://www.murc-kawasesouba.jp/fx/past_3month.php

**計算方法**: 前日のTTS + 0.5

例: 2025年12月26日の処理の場合
- 12月25日のTTS: 22.27円/元
- 使用するレート: 22.27 + 0.5 = 22.77円/元

### Q3: エラー「FBA指示書ファイルが見つかりません」と表示されます

**A:** 以下の点を確認してください：
1. 「ファイル選択」タブでFBA指示書をアップロードしたか
2. ファイル名に「FBA指示書」が含まれているか
3. ファイル形式が.xlsまたは.xlsxか

### Q4: 数量が一致しないというエラーが出ます

**A:** これは**警告**です。処理は続行されますが、以下の点を確認してください：
- 指示書の数量とsend-order-listの数量が一致しているか
- セット数や注文数の計算が正しいか

数量が一致しない場合でも、指示書の数量に基づいて計算されます。

### Q5: 原価計算の検証で「差異あり」と表示されます

**A:** 計算結果と表の原価に差がある場合です。以下の点を確認してください：
1. 為替レートが正しく入力されているか
2. メール情報が正しく入力されているか
3. 各コンポーネントの値が正しいか

大きな差異がある場合は、データを再確認してください。

### Q6: PDFから関税情報が正しく抽出されません

**A:** 以下の方法で修正できます：
1. 「データ確認」タブでPDFプレビューを確認
2. 「🔧 手動で修正する」を展開
3. 正しい値を入力
4. 「✓ 手動入力値を使用」をクリック

### Q7: オプション費用の配分はどうすればいいですか？

**A:** メールのオプション料金と指示書のオプション費用に差がある場合：

1. 「ファイル選択」タブの「追加オプション費用の配分」セクションを開く
2. 配送依頼No.を選択
3. 金額（元）と説明を入力
4. 配分先ASINをカンマ区切りで入力（例: `B0BKFS9N54` または `B0G1LDVHGV,B0G1LL31KR`）
5. 「追加」ボタンをクリック

### Q8: 処理に時間がかかります

**A:** 処理時間は以下の要因で変わります：
- 商品数が多い場合: 数十秒かかる場合があります
- ファイルサイズが大きい場合: 読み込みに時間がかかります

プログレスバーで進捗を確認できます。処理中はページを更新しないでください。

---

## 🔧 トラブルシューティング

### 問題1: ファイルがアップロードできない

**解決方法:**
- ファイル形式を確認（.xls, .xlsx, .pdf が対応）
- ファイルサイズを確認（大きすぎる場合は分割を検討）
- ブラウザを更新（F5キー）

### 問題2: データが正しく表示されない

**解決方法:**
1. 「データ確認」タブで各プレビューを確認
2. エラーメッセージを確認
3. ファイルを再アップロード

### 問題3: 計算結果がおかしい

**解決方法:**
1. 「結果表示」タブの「原価計算の検証」で詳細を確認
2. 為替レートが正しいか確認
3. メール情報が正しく入力されているか確認
4. 各コンポーネントの値を確認

### 問題4: Excelファイルがダウンロードできない

**解決方法:**
- ブラウザのポップアップブロックを確認
- ダウンロードフォルダの権限を確認
- 別のブラウザで試す

### 問題5: ページが表示されない

**解決方法:**
- ブラウザを更新（F5キー）
- キャッシュをクリア
- 別のブラウザで試す（Chrome、Firefox、Edgeなど）

---

## 📞 サポート

問題が解決しない場合は、システム管理者に連絡してください。

以下の情報を含めて連絡すると、迅速に対応できます：
- エラーメッセージの内容
- 使用しているファイル名
- 発生した操作手順

---

## 📝 用語集

| 用語 | 説明 |
|------|------|
| **ASIN** | Amazon Standard Identification Number（商品識別番号） |
| **SKU** | Stock Keeping Unit（在庫管理単位） |
| **原価** | 商品1個あたりの総コスト（購入単価 + 送料 + オプション費用 + 関税） |
| **配送依頼No.** | 配送を依頼する際に割り当てられる番号 |
| **納品プランNo.** | 納品プランを識別する番号 |
| **追跡番号** | 配送を追跡するための番号 |
| **TTS** | Telegraphic Transfer Selling（電信売相場） |

---

**最終更新日**: 2026年1月

